
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.hermez.io/zkEVM/State-Machines/Binary/Binary-State-Machine-typ/">
      
      <link rel="icon" href="../../../../favicon.ico">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>Binary - Polygon zkEVM Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#7e56c2">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="deep-purple" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#binary-state-machine" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Polygon zkEVM Documentation" class="md-header__button md-logo" aria-label="Polygon zkEVM Documentation" data-md-component="logo">
      
  <img src="../../../../logo-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Polygon zkEVM Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Binary
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hermeznetwork/hermez-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../Basic-Concepts/introduction/" class="md-tabs__link md-tabs__link--active">
        Polygon zkEVM
      </a>
    </li>
  

  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../../Hermez_1.0/about/scalability/" class="md-tabs__link">
        Polygon Hermez 1.0
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Polygon zkEVM Documentation" class="md-nav__button md-logo" aria-label="Polygon zkEVM Documentation" data-md-component="logo">
      
  <img src="../../../../logo-white.svg" alt="logo">

    </a>
    Polygon zkEVM Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hermeznetwork/hermez-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Polygon zkEVM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Polygon zkEVM" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Polygon zkEVM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_1" type="checkbox" id="__nav_1_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_1">
          Basic Concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Basic Concepts" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_1">
          <span class="md-nav__icon md-icon"></span>
          Basic Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Basic-Concepts/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Basic-Concepts/fibonacci/" class="md-nav__link">
        First Example: Fibonacci
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Basic-Concepts/simple-state-machine/" class="md-nav__link">
        Simple State Machine
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Basic-Concepts/modular-design/" class="md-nav__link">
        Modular Design
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2" type="checkbox" id="__nav_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_2">
          Architecture
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Architecture" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_2">
          <span class="md-nav__icon md-icon"></span>
          Architecture
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Architecture/zkProver/" class="md-nav__link">
        zkProver
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_3" type="checkbox" id="__nav_1_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_3">
          zkASM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="zkASM" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_3">
          <span class="md-nav__icon md-icon"></span>
          zkASM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../zkASM/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../zkASM/basic-syntax/" class="md-nav__link">
        Basic Syntax
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../zkASM/some-examples/" class="md-nav__link">
        Some Examples
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../zkASM/related-repos/" class="md-nav__link">
        Related Repositories
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_4" type="checkbox" id="__nav_1_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1_4">
          PIL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="PIL" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_4">
          <span class="md-nav__icon md-icon"></span>
          PIL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PIL/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PIL/hello-world-examples/" class="md-nav__link">
        Hello Word Examples
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PIL/components/" class="md-nav__link">
        Components
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PIL/cyclical-nature/" class="md-nav__link">
        Cyclical Nature
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PIL/modularity/" class="md-nav__link">
        Modularity
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PIL/advanced-features/" class="md-nav__link">
        Advanced Features
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../PIL/related-repos/" class="md-nav__link">
        Related Repositories
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_5" type="checkbox" id="__nav_1_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1_5">
          State Machines
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="State Machines" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_5">
          <span class="md-nav__icon md-icon"></span>
          State Machines
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Arithmetic/Arithmetic-State-Machine-typ/" class="md-nav__link">
        Arithmetic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Storage/Storage-State-Machine-typ/" class="md-nav__link">
        Storage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Hashing/Hashing-State-Machine-typ/" class="md-nav__link">
        Hashing
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Binary
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Binary
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#binary-operations-on-256-bit-strings" class="md-nav__link">
    Binary Operations on 256-bit Strings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-design-of-the-binary-sm" class="md-nav__link">
    The Design Of The Binary SM
  </a>
  
    <nav class="md-nav" aria-label="The Design Of The Binary SM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#codes-for-the-binary-operations" class="md-nav__link">
    Codes for the Binary Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#internal-byte-plookups" class="md-nav__link">
    Internal Byte Plookups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connection-with-the-main-sm" class="md-nav__link">
    Connection with the Main SM
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operating-at-byte-level" class="md-nav__link">
    Operating At Byte-Level
  </a>
  
    <nav class="md-nav" aria-label="Operating At Byte-Level">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#addition" class="md-nav__link">
    Addition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subtraction" class="md-nav__link">
    Subtraction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#less-than" class="md-nav__link">
    Less Than
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signed-less-than" class="md-nav__link">
    Signed Less Than
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#equality" class="md-nav__link">
    Equality
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitwise-operations" class="md-nav__link">
    Bitwise Operations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-binary-sm-in-summary" class="md-nav__link">
    The Binary SM In Summary
  </a>
  
    <nav class="md-nav" aria-label="The Binary SM In Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-nutshell" class="md-nav__link">
    The Nutshell
  </a>
  
    <nav class="md-nav" aria-label="The Nutshell">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#translation-to-pil-language" class="md-nav__link">
    Translation to PIL Language
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-of-binary-actions" class="md-nav__link">
    Execution of Binary Actions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-binary-pil-program" class="md-nav__link">
    The Binary PIL (Program)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Memory/memory-state-machine/" class="md-nav__link">
        Memory
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Memory-Align/memory-align-state-machine/" class="md-nav__link">
        Memory Align
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Complementary/complementary-state-machines/" class="md-nav__link">
        Complementaries
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Complementary/configuration-file/" class="md-nav__link">
        Configuration File
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Polygon Hermez 1.0
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Polygon Hermez 1.0" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Polygon Hermez 1.0
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          About
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="About" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/about/scalability/" class="md-nav__link">
        Ethereum Scalability and zk-Rollups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/about/value-proposition/" class="md-nav__link">
        Polygon Hermez Value Proposition
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/about/model/" class="md-nav__link">
        Polygon Hermez Network Model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/about/security/" class="md-nav__link">
        Security
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          Users
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Users" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Users
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/users/hermez-wallet/" class="md-nav__link">
        Polygon Hermez Wallet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/users/mainnet/" class="md-nav__link">
        Polygon Hermez Mainnet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/users/testnet/" class="md-nav__link">
        Polygon Hermez Testnet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/users/exchanges/" class="md-nav__link">
        Exchanges
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3">
          Developers
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developers" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/developers/dev-guide/" class="md-nav__link">
        Developer Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3_2" type="checkbox" id="__nav_2_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3_2">
          Protocol
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Protocol" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_3_2">
          <span class="md-nav__icon md-icon"></span>
          Protocol
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3_2_1" type="checkbox" id="__nav_2_3_2_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3_2_1">
          Polygon Hermez zkRollup protocol
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Polygon Hermez zkRollup protocol" data-md-level="4">
        <label class="md-nav__title" for="__nav_2_3_2_1">
          <span class="md-nav__icon md-icon"></span>
          Polygon Hermez zkRollup protocol
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/developers/protocol/hermez-protocol/protocol/" class="md-nav__link">
        Core protocol
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/developers/protocol/hermez-protocol/contracts/contracts/" class="md-nav__link">
        Smart contracts
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/developers/protocol/hermez-protocol/circuits/circuits/" class="md-nav__link">
        Circuits
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/developers/protocol/consensus/consensus/" class="md-nav__link">
        Forging consensus protocol
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/developers/protocol/withdrawal-delayer/withdrawal-delayer/" class="md-nav__link">
        Withdrawal delayer protocol
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/developers/sdk/" class="md-nav__link">
        Examples/SDK
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/developers/api/" class="md-nav__link">
        API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/developers/batch-explorer/" class="md-nav__link">
        Batch Explorer
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/developers/price-updater/" class="md-nav__link">
        Polygon Hermez NodePrice Updater
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/developers/glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_4">
          FAQ
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="FAQ" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          FAQ
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/faq/end-users/" class="md-nav__link">
        End-Users
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/faq/integrators/" class="md-nav__link">
        Integrators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/faq/coordinators/" class="md-nav__link">
        Coordinators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/faq/pod/" class="md-nav__link">
        Proof of Donation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Hermez_1.0/faq/other/" class="md-nav__link">
        Other
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#binary-operations-on-256-bit-strings" class="md-nav__link">
    Binary Operations on 256-bit Strings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-design-of-the-binary-sm" class="md-nav__link">
    The Design Of The Binary SM
  </a>
  
    <nav class="md-nav" aria-label="The Design Of The Binary SM">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#codes-for-the-binary-operations" class="md-nav__link">
    Codes for the Binary Operations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#internal-byte-plookups" class="md-nav__link">
    Internal Byte Plookups
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connection-with-the-main-sm" class="md-nav__link">
    Connection with the Main SM
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operating-at-byte-level" class="md-nav__link">
    Operating At Byte-Level
  </a>
  
    <nav class="md-nav" aria-label="Operating At Byte-Level">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#addition" class="md-nav__link">
    Addition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#subtraction" class="md-nav__link">
    Subtraction
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#less-than" class="md-nav__link">
    Less Than
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#signed-less-than" class="md-nav__link">
    Signed Less Than
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#equality" class="md-nav__link">
    Equality
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bitwise-operations" class="md-nav__link">
    Bitwise Operations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-binary-sm-in-summary" class="md-nav__link">
    The Binary SM In Summary
  </a>
  
    <nav class="md-nav" aria-label="The Binary SM In Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-nutshell" class="md-nav__link">
    The Nutshell
  </a>
  
    <nav class="md-nav" aria-label="The Nutshell">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#translation-to-pil-language" class="md-nav__link">
    Translation to PIL Language
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#execution-of-binary-actions" class="md-nav__link">
    Execution of Binary Actions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-binary-pil-program" class="md-nav__link">
    The Binary PIL (Program)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/hermeznetwork/hermez-docs/edit/master/docs/zkEVM/State-Machines/Binary/Binary-State-Machine-typ.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<p>[ToC]</p>
<h1 id="binary-state-machine">Binary State Machine</h1>
<p>The Binary State Machine (SM) is one of the six secondary state machines receiving instructions, called Binary Actions, from the Main State Machine Executor.</p>
<p>It is responsible for the execution of all binary operations in the zkProver.</p>
<p>As a secondary state machine, the Binary State Machine has the executor part (the Binary SM Executor) and an internal Binary PIL (program) which is a set of verification rules, written in the PIL language. The Binary SM Executor is written in two versions; Javascript and C/C++.</p>
<p>The Polygon zkEVM Repo is here  <a href="https://github.com/0xPolygonHermez">https://github.com/0xPolygonHermez</a></p>
<p><strong>Binary SM Executor</strong>: <a href="https://github.com/0xPolygonHermez/zkevm-proverjs/blob/main/src/sm/sm_binary.js">sm_binary.js</a></p>
<p><strong>Binary SM PIL</strong>: <a href="https://github.com/0xPolygonHermez/zkevm-proverjs/blob/main/pil/binary.pil">binary.pil</a> </p>
<p><strong>Test Vectors</strong>: <a href="https://github.com/0xPolygonHermez/zkevm-proverjs/blob/main/test/sm/sm_binary_test.js">binary_test.js</a></p>
<h2 id="binary-operations-on-256-bit-strings">Binary Operations on 256-bit Strings</h2>
<p>The zkEVM (zero-knowledge Ethereum Virtual Machine) performs the following binary operations on 256-bit strings,</p>
<ul>
<li><span class="arithmatex">\(\text{ADD }\)</span> (<span class="arithmatex">\(+\)</span>), the addition operation adds two 256-bit numbers.</li>
<li><span class="arithmatex">\(\text{SUB }\)</span> (<span class="arithmatex">\(-\)</span>), the subtraction operation computes the difference between two 256-bit numbers.</li>
<li><span class="arithmatex">\(\text{LT }\)</span> (<span class="arithmatex">\(&lt;\)</span>), the less-than operation checks if a 256-bit number is smaller than another 256-bit number, without considering the signs the numbers.</li>
<li><span class="arithmatex">\(\text{SLT }\)</span> (<span class="arithmatex">\(&lt;\)</span>), the signed less-than operation checks if a 256-bit number is smaller than another 256-bit number, but takes into consideration the respective signs of the numbers.</li>
<li><span class="arithmatex">\(\text{EQ }\)</span> (<span class="arithmatex">\(=\)</span>), the 'equal' operation checks if two 256-bit numbers are equal.</li>
<li><span class="arithmatex">\(\text{AND }\)</span> (<span class="arithmatex">\(\land\)</span>), the operation that computes the bit-wise "AND" of two numbers.</li>
<li><span class="arithmatex">\(\text{OR }\)</span> (<span class="arithmatex">\(\lor\)</span>), the operation computes the bit-wise "OR" of two numbers.</li>
<li><span class="arithmatex">\(\text{XOR }\)</span>  (<span class="arithmatex">\(\oplus\)</span>), the operation computes the bit-wise "XOR" of two numbers.</li>
<li><span class="arithmatex">\(\text{NOT }\)</span> (<span class="arithmatex">\(\neg\)</span>), the operation computes the bit-wise "NOT" of a binary number.</li>
</ul>
<p>In order to understand how the <span class="arithmatex">\(\text{ADD}\)</span>, <span class="arithmatex">\(\text{SUB}\)</span>, <span class="arithmatex">\(\text{LT}\)</span> and <span class="arithmatex">\(\text{SLT}\)</span> operations work, one needs to first understand how the zkEVM codes 256-bit strings to signed and unsigned integers.</p>
<p>Figure 1 shows these codifications for 3-bit strings but the idea can be easily extended to 256-bit strings.</p>
<p><img alt="Codifications of 3-bit strings for signed and unsigned integers as used by the EVM " src="../fig1-cdfctn-3bit-strngs.png" /></p>
<div align="center"><b> Figure 1: Codifications of 3-bit strings for signed and unsigned integers as used by the EVM </b></div>

<p>Adding two strings is performed bit-by-bit using the corresponding carry.</p>
<p>For example, add the 3-bit strings <span class="arithmatex">\(\mathtt{0b001}\)</span> and <span class="arithmatex">\(\mathtt{0b101}\)</span>, where <span class="arithmatex">\(\mathtt{0b}\)</span> means binary,</p>
<ul>
<li>
<p>Start with an initial <span class="arithmatex">\(carry=0\)</span> and add the least significant bits,</p>
<p><span class="arithmatex">\(1+1+carry=1+1+0=0\)</span>, so the next carry becomes <span class="arithmatex">\(carry'=1\)</span>.</p>
</li>
<li>
<p>Next, add the the second least-significant bits using the previous carry, </p>
<p><span class="arithmatex">\(0+0+carry = 0+0+1 = 1\)</span>, this time the next carry is <span class="arithmatex">\(carry'=0\)</span>.</p>
</li>
<li>
<p>Finally, add the most significant bits,</p>
<p><span class="arithmatex">\(0+1+carry=0+1+0=1\)</span>, with the final carry being <span class="arithmatex">\(carry'=0\)</span>.</p>
</li>
<li>
<p>As a result: <span class="arithmatex">\(\mathtt{0b001}+\mathtt{0b101} = \mathtt{0b110}\)</span> with <span class="arithmatex">\(carry=0\)</span>.</p>
</li>
</ul>
<p>The sum <span class="arithmatex">\(\mathtt{0b001}+\mathtt{0b101} = \mathtt{0b110}\)</span>, for unsigned integers is <span class="arithmatex">\(1+5=6\)</span>, while for signed integers encoded with complement to two, this sum is <span class="arithmatex">\(1+(-3) =(-2)\)</span>.</p>
<p>In other words, the same binary sum can be done for both signed integers and for unsigned integers.</p>
<p>The operations <span class="arithmatex">\(\text{LT}\)</span> and <span class="arithmatex">\(\text{SLT}\)</span> are different however.</p>
<p>When comparing unsigned integers (using <span class="arithmatex">\(\text{LT}\)</span>), the natural order for comparisons is applied. For example, <span class="arithmatex">\(010 &lt; 110\)</span>, i.e., <span class="arithmatex">\(2 &lt; 6\)</span>.</p>
<p>When comparing signed integers (using <span class="arithmatex">\(\text{SLT}\)</span>), one must take into account the most significant bit that acts as the sign.</p>
<ul>
<li>
<p>If the most-significant bits of the two strings being compared is the same, the the natural order applies. For example, <span class="arithmatex">\(101  &lt; 110\)</span>. i.e., <span class="arithmatex">\(-3 &lt; -2\)</span></p>
</li>
<li>
<p>However, if the most significant bits of strings being compared are different, then the order must be flipped (bigger numbers start with 0). For example, <span class="arithmatex">\(110 &lt; 001\)</span>. i.e., <span class="arithmatex">\(-2  &lt;  1\)</span>.</p>
</li>
</ul>
<p>Finally, notice that with unsigned integers, there is a caveat since 4 and -4 have the same codification.</p>
<p>On the other hand, the <span class="arithmatex">\(\text{AND}\)</span>, <span class="arithmatex">\(\text{OR}\)</span>, <span class="arithmatex">\(\text{XOR}\)</span> and <span class="arithmatex">\(\text{NOT}\)</span> operations are bit-wise operations, that is to say, the operation is done bit-by-bit. As a result, there is no carry to be considered when operating a pair of bits. This makes the checks easier to implement for bit-wise operations.</p>
<p>Table 1 depicts the truth tables of <span class="arithmatex">\(\text{AND}\)</span>, <span class="arithmatex">\(\text{OR}\)</span> and <span class="arithmatex">\(\text{XOR}\)</span> operators, respectively.</p>
<p><img alt="Truth Tables of bit-wise operations" src="../fig2-trth-tbls-bitws.png" /></p>
<div align="center"><b> Table 1: Truth Tables of bit-wise operations </b></div>

<p>Notice that we do not consider the <span class="arithmatex">\(\text{NOT}\)</span> operation. This is because the <span class="arithmatex">\(\text{NOT}\)</span> operation can be easily implemented with the <span class="arithmatex">\(\text{XOR}\)</span> operation, by taking an <span class="arithmatex">\(\text{XOR}\)</span> of the 256-bit string and <span class="arithmatex">\(\texttt{0xff...ff}\)</span>.</p>
<h2 id="the-design-of-the-binary-sm">The Design Of The Binary SM</h2>
<p>The Executor of the Binary SM records the trace of each computation in the state machine, and this computational trace is used to prove correctness of computations.</p>
<p>The execution trace is typically in the form of 256-bit strings. And the polynomial constraints, that every correct execution trace must satisfy, are described in a PIL file (or 'code').</p>
<p>For the Binary SM, these computations refers to the aforementioned binary operations, and uses special codes for each of the operations.</p>
<h3 id="codes-for-the-binary-operations">Codes for the Binary Operations</h3>
<p>Each operation that the Binary SM checks has a code as shown in Table 2, below. </p>
<p>In instances where none of the defined binary operations is carried out, the Binary SM's operation is considered to be a <span class="arithmatex">\(\text{NOP}\)</span> (No Operation), in which case any code not in the defined list of codes can be used.</p>
<div align="center"><b> Table 2: All Operations Checked by the Binary SM </b></div>

<p><center></p>
<table>
<thead>
<tr>
<th align="center"><span class="arithmatex">\(\textbf{Operation Name}\)</span></th>
<th align="center"><span class="arithmatex">\(\textbf{Mnemonic}\)</span></th>
<th align="center"><span class="arithmatex">\(\textbf{Symbol}\)</span></th>
<th align="center"><span class="arithmatex">\(\textbf{BinOpCode}\)</span></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><span class="arithmatex">\(\text{Addition}\)</span></td>
<td align="center"><span class="arithmatex">\(\mathrm{ADD}\)</span></td>
<td align="center"><span class="arithmatex">\(+\)</span></td>
<td align="center"><span class="arithmatex">\(0\)</span></td>
</tr>
<tr>
<td align="center"><span class="arithmatex">\(\text{Subtraction}\)</span></td>
<td align="center"><span class="arithmatex">\(\mathrm{SUB}\)</span></td>
<td align="center"><span class="arithmatex">\(-\)</span></td>
<td align="center"><span class="arithmatex">\(1\)</span></td>
</tr>
<tr>
<td align="center"><span class="arithmatex">\(\text{Less Than}\)</span></td>
<td align="center"><span class="arithmatex">\(\mathrm{LT}\)</span></td>
<td align="center"><span class="arithmatex">\(&lt;\)</span></td>
<td align="center"><span class="arithmatex">\(2\)</span></td>
</tr>
<tr>
<td align="center"><span class="arithmatex">\(\text{Signed Less Than}\)</span></td>
<td align="center"><span class="arithmatex">\(\mathrm{SLT}\)</span></td>
<td align="center"><span class="arithmatex">\(&lt;\)</span></td>
<td align="center"><span class="arithmatex">\(3\)</span></td>
</tr>
<tr>
<td align="center"><span class="arithmatex">\(\text{Equal To}\)</span></td>
<td align="center"><span class="arithmatex">\(\mathrm{EQ}\)</span></td>
<td align="center"><span class="arithmatex">\(=\)</span></td>
<td align="center"><span class="arithmatex">\(4\)</span></td>
</tr>
<tr>
<td align="center"><span class="arithmatex">\(\text{Bitwise AND}\)</span></td>
<td align="center"><span class="arithmatex">\(\mathrm{AND}\)</span></td>
<td align="center"><span class="arithmatex">\(\wedge\)</span></td>
<td align="center"><span class="arithmatex">\(5\)</span></td>
</tr>
<tr>
<td align="center"><span class="arithmatex">\(\text{Bitwise OR}\)</span></td>
<td align="center"><span class="arithmatex">\(\mathrm{OR}\)</span></td>
<td align="center"><span class="arithmatex">\(\vee\)</span></td>
<td align="center"><span class="arithmatex">\(6\)</span></td>
</tr>
<tr>
<td align="center"><span class="arithmatex">\(\text{Bitwise XOR}\)</span></td>
<td align="center"><span class="arithmatex">\(\mathrm{XOR}\)</span></td>
<td align="center"><span class="arithmatex">\(\oplus\)</span></td>
<td align="center"><span class="arithmatex">\(7\)</span></td>
</tr>
<tr>
<td align="center"><span class="arithmatex">\(\text{No Operation}\)</span></td>
<td align="center"><span class="arithmatex">\(\mathrm{NOP}\)</span></td>
<td align="center"><span class="arithmatex">\(\mathrm{NOP}\)</span></td>
<td align="center"><span class="arithmatex">\(\star\)</span></td>
</tr>
</tbody>
</table>
<p></center></p>
<h3 id="internal-byte-plookups">Internal Byte Plookups</h3>
<p>The Binary SM is internally designed to use plookups of bytes for all the binary operations. </p>
<p>That is, it uses plookups that contain all the possible input bytes and output byte combinations,</p>
<div class="arithmatex">\[
\text{byte}_{in_0} \star \text{byte}_{in_1} = \text{byte}_{out},
\]</div>
<p>where <span class="arithmatex">\(\star\)</span> is one of the possible operations.</p>
<p>When executing a binary operation between the 256-bit input strings, an execution trace is generated in cycles of <span class="arithmatex">\(32\)</span> steps per operation.</p>
<p>At each step, the corresponding byte-wise operation and any required extra information, such as 'carries' or auxiliary values, form part of the computation trace.</p>
<p>Additionally, each <span class="arithmatex">\(256\)</span>-bit string (the two inputs and the output) are expressed using <span class="arithmatex">\(8\)</span> registers of <span class="arithmatex">\(32\)</span>-bits.</p>
<h3 id="connection-with-the-main-sm">Connection with the Main SM</h3>
<p>The constraint that connects the execution trace of the Main SM with the execution trace of the Binary SM is a Plookup, which is performed at each row of the Binary SM execution trace when the cycle is completed (this is when a register called <span class="arithmatex">\(\texttt{RESET}\)</span> is 1).</p>
<p>The Plookup checks the operation code, the registries for the input and output 256-bit strings, and the final carry.</p>
<h2 id="operating-at-byte-level">Operating At Byte-Level</h2>
<p>This section provides examples of how the byte-wise operations work. </p>
<p>A <span class="arithmatex">\(256\)</span>-bit integer <span class="arithmatex">\(\mathbf{a}\)</span> is herein denoted in vector form as <span class="arithmatex">\((a_{31}, \dots, a_1, a_0)\)</span> to indicate that,
$$
\mathbf{a} = a_{31}\cdot (2^8)^{31} + a_{30}\cdot (2^8)^{30} + \cdots + a_1\cdot2^8 + a_0   =
\sum_{i = {31}}^{0} a_i \cdot (2^8)^i,
$$
where each <span class="arithmatex">\(a_i\)</span> is a byte that can take values between <span class="arithmatex">\(0\)</span> and <span class="arithmatex">\(2^8 - 1\)</span>. </p>
<p><strong>Example 1.</strong></p>
<p>If <span class="arithmatex">\(\mathbf{a} = 29967\)</span>, its byte decomposition can be written as <span class="arithmatex">\(\mathbf{a} = (\mathtt{0x75}, \mathtt{0x0F})\)</span>, because <span class="arithmatex">\(\mathbf{a} = 29967 = 117 \cdot 2^8 + 15\)</span>, and in hexadecimal, <span class="arithmatex">\(117 \mapsto \mathtt{0x75}\)</span> and <span class="arithmatex">\(15 \mapsto \mathtt{0x0F}\)</span>.</p>
<h3 id="addition">Addition</h3>
<p>Here is how the addition operation on two <span class="arithmatex">\(256\)</span>-bit numbers is reduced to a byte-by-byte addition, and thus ready to use the byte-wise Plookup table.</p>
<p>Observe that adding two bytes <span class="arithmatex">\(a\)</span> and <span class="arithmatex">\(b\)</span> (i.e., <span class="arithmatex">\(a\)</span> and <span class="arithmatex">\(b\)</span> are members of the set <span class="arithmatex">\([0, 2^8-1]\)</span>), may result in a sum <span class="arithmatex">\(c\)</span> which cannot be expressed as a single byte. </p>
<p>For example, if <span class="arithmatex">\(a = \mathtt{0xFF}\)</span> and <span class="arithmatex">\(b = \mathtt{0x01}\)</span>, then,
$$
a + b = \mathtt{0xFF} + \mathtt{0x01} = \mathtt{0x100}.
$$
In byte-form, <span class="arithmatex">\(c=\mathtt{0x00}\)</span> and with <span class="arithmatex">\(carry'=1\)</span>. This carry has to be taken care of when dealing with bytes.</p>
<p>Consider now the process of adding two bytes. </p>
<p><strong>Example 2.</strong></p>
<p>Take for instance, <span class="arithmatex">\(\mathbf{a} = (a_1, a_0) = (\mathtt{0xFF}, \mathtt{0x01})\)</span> and <span class="arithmatex">\(\mathbf{b} = (b_1, b_0) = (\mathtt{0xF0}, \mathtt{0xFF})\)</span>.</p>
<ul>
<li>First add the less significant bytes:</li>
</ul>
<div class="arithmatex">\[
\begin{aligned}
a_1 + b_1 &amp;= \mathtt{0x01} + \mathtt{0xFF} = c_1 = \mathtt{0x00}, \\
carry_1 &amp;= 1.
\end{aligned}
\]</div>
<ul>
<li>Then, add the next significant byte,</li>
</ul>
<div class="arithmatex">\[
\begin{aligned}
a_2 + b_2 + carry_1 &amp;= \mathtt{0xFF} + \mathtt{0xF0} = c_2 = \mathtt{0xF0}, \\
carry_2 &amp;= 1.
\end{aligned}
\]</div>
<p>The previous example shows is scheme depicts several cases that need to be treated separately;</p>
<ol>
<li>If <span class="arithmatex">\(a_1 + b_1 &lt; 2^8\)</span> and <span class="arithmatex">\(a_2 + b_2 &lt; 2^8\)</span>, then the sum <span class="arithmatex">\(\mathbf{a} + \mathbf{b}\)</span> is simply,</li>
</ol>
<div class="arithmatex">\[
\mathbf{a} + \mathbf{b} = (a_2 + b_2, a_1 + b_1).
\]</div>
<ol>
<li>If <span class="arithmatex">\(a_1 + b_1 &lt; 2^8\)</span> but <span class="arithmatex">\(a_2 + b_2 \geq 2^8\)</span>, then <span class="arithmatex">\(a_2 + b_2\)</span> does not fit in a single byte. Hence, the sum of <span class="arithmatex">\(a_2\)</span> and <span class="arithmatex">\(b_2\)</span> has to be written as,</li>
</ol>
<div class="arithmatex">\[
a_2 + b_2 = 1 \cdot 2^8 + c_2,
\]</div>
<p>​    for some byte <span class="arithmatex">\(c_2\)</span>. The addition <span class="arithmatex">\(\mathbf{a} + \mathbf{b}\)</span> is then computed as follows, 
$$
\mathbf{a} + \mathbf{b} = (1, c_2, a_1 + b_1).
$$</p>
<ol>
<li>If <span class="arithmatex">\(a_1 + b_1 \geq 2^8\)</span>, then we have that:</li>
</ol>
<div class="arithmatex">\[
a_1 + b_1 = 1 \cdot 2^8 + c_1,
\]</div>
<p>​   for some byte <span class="arithmatex">\(c_1\)</span>. Then we can write,
$$
\mathbf{a} + \mathbf{b} = (a_2 + b_2 + 1) \cdot 2^8 + c_1.
$$</p>
<p>Consider the following two scenarios:</p>
<p>(a) If <span class="arithmatex">\(a_2 + b_2 + 1 \geq 2^8\)</span>, then the sum will take the form:
$$
a_2 + b_2 + 1 = 1 \cdot 2^8 + c_2.
$$
​   Therefore, the byte decomposition of <span class="arithmatex">\(\mathbf{a} + \mathbf{b}\)</span> is,
$$
\mathbf{a} + \mathbf{b} = (1, c_2, c_1).
$$
(b) If <span class="arithmatex">\(a_2 + b_2 + 1 &lt; 2^8\)</span>, then the byte decomposition of <span class="arithmatex">\(\mathbf{a} + \mathbf{b}\)</span> is:
$$
\mathbf{a} + \mathbf{b} = (c_2, c_1).
$$
Observe that addition of <span class="arithmatex">\(256\)</span>-bit numbers can be reduced to additions at byte-level by operating through the previous cases in an iterative manner. </p>
<h3 id="subtraction">Subtraction</h3>
<p>Reducing Subtraction to byte-level turns out to be trickier than Addition case. </p>
<p>Suppose <span class="arithmatex">\(\mathbf{a} = \mathtt{0x0101}\)</span> and <span class="arithmatex">\(\mathbf{b} = \mathtt{0x00FF}\)</span>. </p>
<p>Observe that <span class="arithmatex">\(\mathtt{0xFF}\)</span> cannot be subtracted from <span class="arithmatex">\(\mathtt{0x01}\)</span> because <span class="arithmatex">\(\mathtt{0xFF} &gt; \mathtt{0x01}\)</span>.</p>
<p>However, we know that the result is <span class="arithmatex">\(\mathbf{a} - \mathbf{b} = \mathbf{c} = \mathtt{0x0002}\)</span>.</p>
<p>In order to get this result, notice that the operation can be described as follows,</p>
<div class="arithmatex">\[
\begin{aligned}
\mathbf{a} - \mathbf{b} &amp; = (\mathtt{0x01} - \mathtt{0x00}) \cdot 2^8 + (\mathtt{0x01} - \mathtt{0xFF}) \\
   &amp; = (\mathtt{0x01} - \mathtt{0x00}) \cdot 2^8  - 2^8 + 2^8 + (\mathtt{0x01} - \mathtt{0xFF}) \\
   &amp; = (\mathtt{0x01} - \mathtt{0x00 - 0x01}) \cdot 2^8  + \mathtt{0xFF + 0x01} + \mathtt{0x01} - \mathtt{0xFF} \\
   &amp; = ( \mathtt{0x00} ) \cdot 2^8  + \mathtt{0x02}
\end{aligned}
\]</div>
<p>The output byte decomposition is <span class="arithmatex">\(\mathbf{a} = (c_1, c_0)  = (\mathtt{0x00}, \mathtt{0x02})\)</span>. </p>
<p>Nonetheless, it may be necessary to look at more examples so as to better understand how subtraction works at byte-level in a more general sense.</p>
<p>Consider now subtraction of numbers with <span class="arithmatex">\(3\)</span> bytes. Say, <span class="arithmatex">\(a = \mathtt{0x0001FE}\)</span> and <span class="arithmatex">\(b = \mathtt{0xFEFFFF}\)</span>.</p>
<p>First analyse the first two bytes, as in the previous example,</p>
<div class="arithmatex">\[
\begin{aligned}
(\mathtt{0x01} - \mathtt{0xFF}) \cdot 2^8 + (\mathtt{0xFE} - \mathtt{0xFF}) &amp;= (\mathtt{0x01} - \mathtt{0xFF} - \mathtt{0x01} ) \cdot 2^8 + (\mathtt{2^8} + \mathtt{0xFE} - \mathtt{0xFF}) \\
&amp; = (\mathtt{0x01} - \mathtt{0xFF - 0x01}) \cdot 2^8 + \mathtt{0xFF}
\end{aligned}
\]</div>
<p>But now observe that <span class="arithmatex">\(\mathtt{0x01} - \mathtt{0xFF} - \mathtt{0x01}\)</span> is also a negative value. Hence, there is a need to repeat the strategy and keep a carry to the next byte,</p>
<div class="arithmatex">\[
\begin{aligned}
&amp;(\mathtt{0x00} - \mathtt{0xFE}) \cdot 2^{16} + (\mathtt{0x01} - \mathtt{0xFF} - \mathtt{0x01}) \cdot 2^8 + \mathtt{0xFF} = \\
&amp;(\mathtt{0x00} - \mathtt{0xFE} - \mathtt{0x01}) \cdot 2^{16} + (\mathtt{2^8} + \mathtt{0x01} - \mathtt{0xFF} - \mathtt{0x01}) \cdot 2^8 + \mathtt{0xFF} = \\
&amp;(\mathtt{0x00} - \mathtt{0xFE} - \mathtt{0x01}) \cdot 2^{16} + \mathtt{0x01} \cdot 2^8 + \mathtt{0xFF}. 
\end{aligned}
\]</div>
<p>Observe that the previous example is included in this case. </p>
<p>In general, let <span class="arithmatex">\(a = (a_i)_i\)</span> and <span class="arithmatex">\(b = (b_i)_i\)</span>, with <span class="arithmatex">\(a_i, b_i\)</span> bytes, be the byte representations of <span class="arithmatex">\(a\)</span> and <span class="arithmatex">\(b\)</span>. Instead of checking if we can perform the subtraction <span class="arithmatex">\(a_i - b_i\)</span> for some bytes <span class="arithmatex">\(i\)</span>, we are checking if <span class="arithmatex">\(a_i - b_i - \texttt{carry} \geq 0\)</span>. Equivalently, we are checking if <span class="arithmatex">\(a_i - \texttt{carry} \geq b_i\)</span>. The previous case can be recovered by setting <span class="arithmatex">\(\texttt{carry} = 1\)</span> and the first case corresponds to setting <span class="arithmatex">\(\mathtt{carry = 0}\)</span>. </p>
<p>We have two possible cases,</p>
<ul>
<li>If <span class="arithmatex">\(a_i - \texttt{carry} \geq b_i\)</span>, then <span class="arithmatex">\(a_i - b_i - \texttt{carry}\)</span> provides the corresponding <span class="arithmatex">\(i\)</span>-th byte of the representation of <span class="arithmatex">\(a - b\)</span>.</li>
<li>If <span class="arithmatex">\(a_i - \texttt{carry} &lt; b_i\)</span> then we should compute the corresponding <span class="arithmatex">\(i\)</span>-th byte of the representation of <span class="arithmatex">\(a - b\)</span> as,</li>
</ul>
<div class="arithmatex">\[
2^8 - b_i + a_i - \texttt{carry} = 255 - b_i + a_i - \texttt{carry} + 1.
\]</div>
<p>However, we need to discuss the last step of our example. Observe that we can not perform the operation <span class="arithmatex">\(\mathtt{0x00} - \mathtt{0xFE} - \mathtt{0x01}\)</span> since it corresponds to a negative value. But as we are working with unsigned integers, we will do the two's complement and set the last byte to, 
$$
2^8 - \mathtt{0xFE} + \mathtt{0x00} - \mathtt{0x01} = 255 - \mathtt{0xFE} + \mathtt{0x00} - \mathtt{0x01} + 1 = 255 - b_3 + a_3 - \texttt{carry} + 1.
$$</p>
<p>Observe that this is also included in the case when <span class="arithmatex">\(a_i - \texttt{carry} &lt; b_i\)</span>, so we must not treat the last bit in a different manner. To end up with our example, we get the following byte representation of <span class="arithmatex">\(a - b\)</span>,
$$
c = (\mathtt{0x01}, \mathtt{0x01}, \mathtt{0xFF}) = \mathtt{0x01} \cdot 2^{16} + \mathtt{0x01} \cdot 2^8 + \mathtt{0xFF}.
$$</p>
<h3 id="less-than">Less Than</h3>
<p>We want to describe the less than comparator byte-wise. For <span class="arithmatex">\(256\)</span>-bits integers, the operation <span class="arithmatex">\(&lt;\)</span> will output <span class="arithmatex">\(c = 1\)</span> if <span class="arithmatex">\(a &lt; b\)</span> and <span class="arithmatex">\(c = 0\)</span> otherwise. As we are working in the natural integers order, the most significant byte decide and, if they are equal, we should consider the previous one until we can decide. Let us propose the example with <span class="arithmatex">\(a = \mathtt{0xFF AE 09}\)</span> and <span class="arithmatex">\(b = \mathtt{0x FF AE 02}\)</span>. We know that <span class="arithmatex">\(a &gt; b\)</span>. Why? We should start at the most significant byte. We know that
$$
a \mathtt{&gt;&gt; 16} = \mathtt{0x FF} = \mathtt{0x FF} = b \mathtt{&gt;&gt; 16}.
$$</p>
<p>Hence, we can not decide with this byte. An the same happens with the second byte, they are both equal to <span class="arithmatex">\(\mathtt{0x AE}\)</span>. Hence, the less significant byte decides, 
$$
\mathtt{0x 09} &gt; \mathtt{0x 02}.
$$</p>
<p>However, the problem with our set up is that we must start with the less significant byte and climb up to the most significant byte. The strategy will be to use some kind of a carry in order to "carry" the decisions from previous bytes. Let us do an example step by step, now with <span class="arithmatex">\(a = \mathtt{0x FF AA 02}\)</span> and <span class="arithmatex">\(b = \mathtt{0x 01 AA 09}\)</span>. First of all, we will compare the less significant bytes. Since
$$
\mathtt{0x 02} &lt; \mathtt{0x 09},
$$
we will set up <span class="arithmatex">\(\mathtt{carry} = 1\)</span>. We will carry this decision until we finish to process all bytes or, alternatively, we should change to the complementary decision. Therefore, since the next two bytes are equal and we are not at the end, we maintain <span class="arithmatex">\(\mathtt{carry}\)</span> to <span class="arithmatex">\(1\)</span>. The previous step is the last one. We compare the most significant bytes,
$$
\mathtt{0x FF} \not &lt; \mathtt{0x 01}.
$$</p>
<p>Henceforth, we should output a <span class="arithmatex">\(0\)</span>, independently to the previous carry decision. But, let us suppose now that <span class="arithmatex">\(b = \mathtt{0x FF AA 09}\)</span>. Then, in this last step, we should output a <span class="arithmatex">\(1\)</span>, since <span class="arithmatex">\(a &lt; b\)</span>. The idea is that, in the last step, if both bytes are equal, we should output the decision carry <span class="arithmatex">\(\mathtt{carry}\)</span>. In general, in the step <span class="arithmatex">\(i\)</span>, comparing bytes <span class="arithmatex">\(a_i\)</span> and <span class="arithmatex">\(b_i\)</span>, we have <span class="arithmatex">\(3\)</span> cases,</p>
<ul>
<li>If <span class="arithmatex">\(a_i &lt; b_i\)</span>, we set <span class="arithmatex">\(\mathtt{carry}\)</span> to <span class="arithmatex">\(1\)</span>. If we are at the most significant byte, we output <span class="arithmatex">\(1\)</span>.</li>
<li>If <span class="arithmatex">\(a_i = b_i\)</span>, we let <span class="arithmatex">\(\mathtt{carry}\)</span> unchanged in order to maintain the previous decision. If we are at the most significant byte, we output <span class="arithmatex">\(\mathtt{carry}\)</span>.</li>
<li>If <span class="arithmatex">\(a_i &gt; b_i\)</span>, we set <span class="arithmatex">\(\mathtt{carry}\)</span> to <span class="arithmatex">\(0\)</span>. If we are at the most significant byte, we output <span class="arithmatex">\(0\)</span>. </li>
</ul>
<h3 id="signed-less-than">Signed Less Than</h3>
<p>In computer science, the most common method of representing signed integers on computers, is called \textbf{two's complement}. When the most significant bit is a one, the number is signed as negative. The way to express a negative integer <span class="arithmatex">\(x\)</span> into two's complement form is chosen so that, among integers of the same sign, the lexicographical order is maintained. That is, if <span class="arithmatex">\(a &lt; b\)</span> are signed integers of the same sign, then its two's complement representations preserve the same order. This will not be true if the signs are different. For example, it is not surprising that
$$
000\dots0 &gt; 111\dots1
$$
using the two's complement encoding, because <span class="arithmatex">\(111\dots1\)</span> is negative and <span class="arithmatex">\(000\dots0\)</span> is positive. The two's complement form of negative integer <span class="arithmatex">\(x\)</span> in a <span class="arithmatex">\(N\)</span>-bits system is the binary representation of <span class="arithmatex">\(2^N - x\)</span>. For example, let <span class="arithmatex">\(x = -1\)</span> and <span class="arithmatex">\(N = 4\)</span>. Then,
$$
10000 - 0001 = 1111.
$$
Hence, <span class="arithmatex">\(-1 = 1111\)</span> in this representation. It is easy to see that <span class="arithmatex">\(-2 = 1110\)</span> because
$$
10000 - 0010 = 1110.
$$</p>
<p>Hence, observe that <span class="arithmatex">\(-1 &gt; -2\)</span> because <span class="arithmatex">\(1111 &gt; 1110\)</span> and conversely: the order is preserved for integers of the same sign. </p>
<p>We will describe a method to compare signed integers byte-wise. First of all, let us analyze the order among all the signed bytes, in order to understand how to compare them. Once we achieve this, the strategy will be very similar to the previous Less Than. </p>
<p>Let <span class="arithmatex">\(a = (a_{31}, a_{30}, \dots, a_0)\)</span> and <span class="arithmatex">\(b = (b_{31}, b_{30}, \dots, b_0)\)</span> be the byte-representation of the 256-bits unsigned integers <span class="arithmatex">\(a\)</span> and <span class="arithmatex">\(b\)</span>. We will define <span class="arithmatex">\(\texttt{sgn}(a) = a_{31, 7}\)</span>, where
$$
a_{31} = \sum_{i = 0}^7 a_{31, i} \cdot 2^i
$$
is the binary representation of <span class="arithmatex">\(a_{31}\)</span>. That is, <span class="arithmatex">\(\texttt{sgn}(a)\)</span> is the most significant bit of <span class="arithmatex">\(a\)</span> or, equivalently, the "sign" of <span class="arithmatex">\(a\)</span>. In a similar way, we define <span class="arithmatex">\(\texttt{sgn}(b)\)</span>. Observe that it is easy to compare <span class="arithmatex">\(a\)</span> and <span class="arithmatex">\(b\)</span> if <span class="arithmatex">\(\texttt{sgn}(a) \neq \texttt{sgn}(b)\)</span>. For example,
$$
a = \mathtt{0b11111111} = \mathtt{0xFF} &lt; \mathtt{0x00} = \mathtt{0b00000000} = b
$$
because <span class="arithmatex">\(\texttt{sgn}(a) &gt; \texttt{sgn}(b)\)</span> i.e. <span class="arithmatex">\(a\)</span> is negative and <span class="arithmatex">\(b\)</span> is positive. If <span class="arithmatex">\(\texttt{sgn}(a) \neq \texttt{sgn}(b)\)</span>, we can simply compare <span class="arithmatex">\(a\)</span> and <span class="arithmatex">\(b\)</span> using the same strategy as before, because the natural lexicographic order is preserved in this case. Then, we have the following cases when comparing <span class="arithmatex">\(a\)</span> and <span class="arithmatex">\(b\)</span>:</p>
<ol>
<li>If <span class="arithmatex">\(\texttt{sgn}(a) = 1\)</span> and <span class="arithmatex">\(\texttt{sgn}(b) = 0\)</span>, then <span class="arithmatex">\(a &lt; b\)</span>.</li>
<li>If <span class="arithmatex">\(\texttt{sgn}(a) = 0\)</span> and <span class="arithmatex">\(\texttt{sgn}(b) = 1\)</span>, then <span class="arithmatex">\(a &gt; b\)</span>.</li>
<li>If <span class="arithmatex">\(\texttt{sgn}(a) = \texttt{sgn}(b)\)</span>, the order is the usual one and hence, we already know how to compare <span class="arithmatex">\(a\)</span> and <span class="arithmatex">\(b\)</span>. </li>
</ol>
<p>​   </p>
<p>Recall that we are processing the bytes of <span class="arithmatex">\(a\)</span> and <span class="arithmatex">\(b\)</span> from the less significant bytes to the most significant bytes. Hence, we need to adapt our strategy following this order. The strategy will be almost the same than in the unsigned operation. </p>
<ol>
<li>First of all, we start comparing <span class="arithmatex">\(a_0\)</span> and <span class="arithmatex">\(b_0\)</span>. </li>
</ol>
<p>​   (a) If <span class="arithmatex">\(a_0 &lt; b_0\)</span>, we set <span class="arithmatex">\(\texttt{carry} = 1\)</span>.</p>
<p>​   (b) Otherwise we set <span class="arithmatex">\(\texttt{carry} = 0\)</span>.  </p>
<ol>
<li>For all <span class="arithmatex">\(0 &lt; i &lt; 31\)</span>, we compare <span class="arithmatex">\(a_i\)</span> and <span class="arithmatex">\(b_i\)</span>.</li>
</ol>
<p>​   (a) If <span class="arithmatex">\(a_i &lt; b_i\)</span>, we set <span class="arithmatex">\(\texttt{carry} = 1\)</span>.</p>
<p>​   (b) If <span class="arithmatex">\(a_i = b_i\)</span>, we leave <span class="arithmatex">\(\texttt{carry}\)</span> unchanged from the previous step.</p>
<p>​   (c) Otherwise, we set <span class="arithmatex">\(\texttt{carry} = 0\)</span>.</p>
<ol>
<li>Now, we have to compare the last byte. We follow the described strategy of comparing the signs:</li>
</ol>
<p>​   (a) If <span class="arithmatex">\(\texttt{sgn}(a) &gt; \texttt{sgn}(b)\)</span>, we output a <span class="arithmatex">\(1\)</span>, so <span class="arithmatex">\(a &lt; b\)</span>.</p>
<p>​   (b) If <span class="arithmatex">\(\texttt{sgn}(a) &lt; \texttt{sgn}(b)\)</span>, we output a <span class="arithmatex">\(0\)</span>, so <span class="arithmatex">\(a &lt; b\)</span>.</p>
<p>​   (c) If <span class="arithmatex">\(\texttt{sgn}(a) = \texttt{sgn}(b)\)</span>, we compare the last bytes <span class="arithmatex">\(a_{31}\)</span> and <span class="arithmatex">\(b_{31}\)</span> in the same way we have compare the previous bytes. We output <span class="arithmatex">\(0\)</span> or <span class="arithmatex">\(1\)</span> accordingly.</p>
<p>​             (i)   If <span class="arithmatex">\(a_{31} &lt; b_{31}\)</span>, we output a <span class="arithmatex">\(1\)</span>, so <span class="arithmatex">\(a &lt; b\)</span>.</p>
<p>​            (ii)   If <span class="arithmatex">\(a_{31} = b_{31}\)</span>, we output the previous <span class="arithmatex">\(\texttt{carry}\)</span>, maintaining the last decision.</p>
<p>​           (iii)   Otherwise, we output a <span class="arithmatex">\(0\)</span>, so <span class="arithmatex">\(a \not &lt; b\)</span>. </p>
<p>Let us exemplify the previous procedure setting <span class="arithmatex">\(a = \mathtt{0xFF FF FF 00}\)</span> and <span class="arithmatex">\(b = \mathtt{0x00 FF FF FF}\)</span>. We know that <span class="arithmatex">\(a &lt; b\)</span>, so we should output a <span class="arithmatex">\(1\)</span>. Observe that the less significant byte of <span class="arithmatex">\(a\)</span> is leaser than the less significant byte of <span class="arithmatex">\(b\)</span>. Hence, we should put <span class="arithmatex">\(\texttt{carry}\)</span> equal to <span class="arithmatex">\(1\)</span>. The next two bytes of <span class="arithmatex">\(a\)</span> and <span class="arithmatex">\(b\)</span> are both equal to <span class="arithmatex">\(\mathtt{0xFF FF}\)</span>, therefore we maintain <span class="arithmatex">\(\texttt{carry}\)</span> unchanged equal to <span class="arithmatex">\(1\)</span>. However, since <span class="arithmatex">\(a\)</span> is negative and <span class="arithmatex">\(b\)</span> is positive, we should change the decision and output a <span class="arithmatex">\(1\)</span>, independently of the <span class="arithmatex">\(\texttt{carry}\)</span>. </p>
<h3 id="equality">Equality</h3>
<p>We want to describe the equality comparator byte-wise. For unsigned <span class="arithmatex">\(256\)</span>-bits integers, the operation <span class="arithmatex">\(=\)</span> will output <span class="arithmatex">\(c = 1\)</span> if <span class="arithmatex">\(a = b\)</span> and <span class="arithmatex">\(c = 0\)</span> otherwise. This operation is very simple to describe byte-wise, since <span class="arithmatex">\(a = b\)</span> if and only if all its bytes coincide. </p>
<p>Let us compare <span class="arithmatex">\(a = \mathtt{0xFF 00 a0 10}\)</span> and <span class="arithmatex">\(b = \mathtt{0xFF 00 00 10}\)</span> byte-wise. Observe that the first byte is the same <span class="arithmatex">\(\mathtt{0x10}\)</span>, however the next byte are different <span class="arithmatex">\(\mathtt{0xa0} \neq \mathtt{0x00}\)</span>. Hence, we can finish here and state that <span class="arithmatex">\(a \neq b\)</span>. </p>
<p>We will describe an algorithm in order to proceed processing all the bytes. We will use a carry to mark up when a difference among bytes has <span class="arithmatex">\(\textbf{not}\)</span> been found (i.e. if <span class="arithmatex">\(\texttt{carry}\)</span> reach <span class="arithmatex">\(0\)</span>, then <span class="arithmatex">\(a\)</span> and <span class="arithmatex">\(b\)</span> should differ). Hence, the algorithm to compare two <span class="arithmatex">\(32\)</span>-bytes integers <span class="arithmatex">\(a = (a_{31}, a_{30}, \dots, a_{0})\)</span> and <span class="arithmatex">\(b = (b_{31}, b_{30}, \dots, b_0)\)</span> is the following:</p>
<ol>
<li>
<p>First of all, since no differences have been found up to this point, set <span class="arithmatex">\(\texttt{carry}\)</span> equal to <span class="arithmatex">\(1\)</span>.</p>
</li>
<li>
<p>Now, compare <span class="arithmatex">\(a_0\)</span> and <span class="arithmatex">\(b_0\)</span>,</p>
</li>
</ol>
<p>(a)  If <span class="arithmatex">\(a_0\)</span> and <span class="arithmatex">\(b_0\)</span> are equal, then leave <span class="arithmatex">\(\texttt{carry}\)</span> unchanged equal to <span class="arithmatex">\(1\)</span>.</p>
<p>(b)  If <span class="arithmatex">\(a_0 \neq b_0\)</span>, then set <span class="arithmatex">\(\texttt{carry}\)</span> equal to <span class="arithmatex">\(0\)</span>, which will imply that <span class="arithmatex">\(a \neq b\)</span>.</p>
<ol>
<li>When comparing bytes <span class="arithmatex">\(a_i\)</span> and <span class="arithmatex">\(b_i\)</span> for <span class="arithmatex">\(0 &lt; i \leq 31\)</span>.</li>
</ol>
<p>(a)  If <span class="arithmatex">\(a_i = b_i \textbf{ and } \texttt{carry} = 1\)</span>, we should leave <span class="arithmatex">\(\texttt{carry}\)</span> unchanged and, if <span class="arithmatex">\(i = 31\)</span>, we should output a <span class="arithmatex">\(1\)</span> because <span class="arithmatex">\(a = b\)</span>. The reason of demanding <span class="arithmatex">\(\texttt{carry} = 1\)</span> in the enter condition is because we should ensure that, if <span class="arithmatex">\(\texttt{carry} = 0\)</span> in a previous step, we must never enter to this block and change the non-equality decision. This is because if <span class="arithmatex">\(a_i \neq b_i\)</span> for some <span class="arithmatex">\(i\)</span>, then <span class="arithmatex">\(a \neq b\)</span>.</p>
<p>(b)  Hence, if <span class="arithmatex">\(a_i \neq b_i\)</span>, we should set <span class="arithmatex">\(\texttt{carry} = 0\)</span> and output a <span class="arithmatex">\(0\)</span> if <span class="arithmatex">\(i = 31\)</span>. </p>
<p>​   </p>
<h3 id="bitwise-operations">Bitwise Operations</h3>
<p>We will describe all bitwise operations at once because they are the easiest ones, since we do not need to introduce carries. </p>
<p>Now, the idea is to extend this operation bitwise. That is, if we have the following binary representations of <span class="arithmatex">\(a = (a_{31}, a_{30}, \dots, a_{0})\)</span> and <span class="arithmatex">\(a = (b_{31}, b_{30}, \dots, b_{0})\)</span> where <span class="arithmatex">\(a_i, b_i \in \{0, 1\}\)</span>, then we define,</p>
<div class="arithmatex">\[
a \star b = (a_i \star b_i)_i = (a_{31} \star b_{31}, a_{30} \star b_{30}, \dots, a_0 \star b_0)
\]</div>
<p>for <span class="arithmatex">\(\star\)</span> being <span class="arithmatex">\(\land, \lor\)</span> or <span class="arithmatex">\(\oplus\)</span>. </p>
<p>For example, if <span class="arithmatex">\(a = \mathtt{0xCB} = \mathtt{0b11001011}\)</span> and <span class="arithmatex">\(b = \mathtt{0xEA} = \mathtt{0b11101010}\)</span> then,</p>
<div class="arithmatex">\[
\begin{aligned}
a \land b &amp;= \mathtt{0b11001010} = \mathtt{0xCA},\\
a \lor b &amp;= \mathtt{0b11101011} = \mathtt{0xEB},\\
a \oplus b &amp;= \mathtt{0b00100001} = \mathtt{0x21}.
\end{aligned}
\]</div>
<h2 id="the-binary-sm-in-summary">The Binary SM In Summary</h2>
<p>The Binary SM has 8 registries, each with an 32-bit Input/Output capacity. i.e., A total of 256 bits.</p>
<p>It carries out binary computations in accordance with instructions from the Main SM Executor.</p>
<p>The binary operations it executes, together with their specific opcodes, are;</p>
<ol>
<li>The common operations; the No-Operation <code>NOP</code>, Addition <code>ADD</code> and Subtraction <code>SUB</code>. Their corresponding special opcodes are; <code>0</code>, <code>1</code> and <code>2</code>, respectively.</li>
<li>The Boolean operations; <span class="arithmatex">\(\text{Less Than }\)</span> <code>LT</code>, <span class="arithmatex">\(\text{Greater Than }\)</span> <code>GT</code>, <span class="arithmatex">\(\text{Signed Less Than }\)</span> <code>SLT</code>, <span class="arithmatex">\(\text{Signed Greater Than }\)</span> <code>SGT</code>, <span class="arithmatex">\(\text{Equal }\)</span> <code>EQ</code>  and  <span class="arithmatex">\(\text{Is-Zero }\)</span> <code>ISZERO</code>. Their special opcodes are, <code>3</code>, <code>4</code>, <code>5</code>, <code>6</code> and <code>7</code>, respectively.</li>
<li>The logical operations; <code>AND</code>, <code>OR</code>,  <code>XOR</code> and <code>NOT</code>, each with its special opcode; <code>9</code> ,<code>10</code>, <code>11</code> and <code>12</code>, respectively.</li>
</ol>
<h3 id="the-nutshell">The Nutshell</h3>
<p>Firstly, the Binary SM Executor translates the Binary Actions into the PIL language. </p>
<p>Secondly, it executes the Binary Actions. </p>
<p>And thirdly, it uses the Binary PIL program <a href="https://github.com/0xPolygonHermez/zkevm-proverjs/blob/main/pil/binary.pil">binary.pil</a>, to check correct execution of the Binary Actions using <a href="">Plookup</a>.</p>
<h4 id="translation-to-pil-language">Translation to PIL Language</h4>
<p>It builds the constant polynomials, which are generated once-off at the beginning. These are; </p>
<ul>
<li>the 4 bits long operation code <code>P_OPCODE</code>, </li>
<li>the 1-bit Carry-in  <code>P_CIN</code>, </li>
<li>the Last-byte <code>P_LAST</code>, </li>
<li>the 1 byte input polynomials <code>P_A</code> and <code>P_B</code>, </li>
<li>the 16-bit output polynomial <code>P_C</code>, </li>
<li>the 1-bit Carry-out <code>P_COUT</code>.</li>
</ul>
<p>It also creates constants required in the Binary PIL program;</p>
<ul>
<li><code>RESET</code> is used to reset registry values every time the state machine completes a cycle of state transitions,</li>
<li><code>FACTOR</code>, which is an array of size 8, is used for correct placement of output registry values.</li>
</ul>
<h4 id="execution-of-binary-actions">Execution of Binary Actions</h4>
<p>The crux of the Binary SM Executor is in the <code>lines 371 to 636</code> of <a href="https://github.com/0xPolygonHermez/zkevm-proverjs/blob/main/src/sm/sm_binary.js">sm_binary.js</a>. This is where it executes Binary Actions. </p>
<ol>
<li>
<p>It takes the committed polynomials A, B and C, breaks them into bytes (in little-endian form). </p>
</li>
<li>
<p>It sequentially pushes each triplet of bytes (<code>freeInA</code>, <code>freeInB</code>, <code>freeInC</code>) into their corresponding registries (<code>ai</code>, <code>bi</code>, <code>ci</code>).</p>
</li>
</ol>
<p>i.e., It runs one for-loop for all committed polynomials (A, B, C), over all the bytes of the 8 registries, which are altogether 32 bytes per committed polynomial. </p>
<p>Recall that <code>LATCH_SIZE = REGISTERS_NUM * BYTES_PER_REGISTER</code> = 8 registries * 4 bytes. It hence amounts to 32 bytes for each committed polynomial.</p>
<ol>
<li>
<p>Once the 256-bit LATCH is built, it checks the opcodes and then computes the required binary operations in accordance with the instructions of the Main SM. </p>
</li>
<li>
<p>It also generates the final registries. </p>
</li>
</ol>
<h4 id="the-binary-pil-program">The Binary PIL (Program)</h4>
<p>There are two types of inputs to the Binary PIL program: the constant polynomials and the committed polynomials.</p>
<p>The program operates byte-wise to carry out 256-bit Plookup operations.</p>
<p>Each row of the lookup table is a vector of the form; { <code>P_LAST</code>, <code>P_OPCODE</code>, <code>P_A</code>, <code>P_B</code>, <code>P_CIN</code>, <code>P_C</code>, <code>P_COUT</code> },  consisting of the constant polynomials created by the Binary SM Executor. As seen above,</p>
<ul>
<li><code>P_LAST</code> is the Last-byte, </li>
<li><code>P_OPCODE</code> is the 4-bit operation code, </li>
<li><code>P_A</code> and <code>P_B</code>, are the 1-byte input polynomials,</li>
<li>
<p><code>P_CIN</code> is the 1-bit Carry-in,</p>
</li>
<li>
<p><code>P_C</code> is the 16-bit output polynomial, </p>
</li>
<li><code>P_COUT</code> is the 1-bit Carry-out.</li>
</ul>
<p>The Binary PIL program takes in byte-size inputs, as in the Binary SM Executor, each 256-bit input committed polynomial is first broken into 32 bytes.</p>
<p>For each of the 32 triplets <code>freeInA</code>, <code>freeInB</code> and <code>freeInC</code>, tallying with the three 256-bit committed polynomials  A,B and C, the Binary PIL program,</p>
<ol>
<li>Prepares a Plookup input vector of the form;  {<code>last</code>, <code>opcode</code>, <code>freeInA</code>, <code>freeInB</code>, <code>cIn</code>, <code>freeInC</code>, <code>cOut</code>}, where each element is a byte.</li>
<li>Runs Plookup,</li>
</ol>
<p><code>{last,opcode,freeInA,freeInB,cIn,freeInC,cOut} in {P_LAST,P_OPCODE,P_A,P_B,P_CIN,P_C,P_COUT};</code></p>
<ol>
<li>Resets registry values at the end of the 32 cycles using <code>RESET</code>, and utilising <code>FACTOR</code> for correct placement of values. For e.g., <code>a0' = a0 * (1 - RESET) + freeInA * FACTOR[0];</code></li>
</ol>
<p>Special variables, <code>useCarry</code> and <code>c0Temp</code>, are used for managing updates and assignments of values, particularly for Boolean operations, where the output <code>c0</code> registry value is either <code>TRUE = 1</code> or <code>FALSE = 0</code>. Hence the Lines 104 and 105 of code;</p>
<p>Line 104.    <code>c0Temp' = c0Temp * (1 - RESET) + freeInC * FACTOR[0];</code></p>
<p>Line 105.    <code>c0' = useCarry * (cOut - c0Temp ) + c0Temp;</code></p>
<p>For all non-Boolean operations; the default value for <code>useCarry</code> is zero, making <code>c0' = c0Temp</code>. The value of <code>c0'</code> is therefore of the same form as other <code>ci'</code> update values.</p>
<ol>
<li>The output of the Binary PIL program is therefore a report of either <code>pass</code> or <code>fail</code>.</li>
</ol>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../../Hashing/Hashing-State-Machine-typ/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Hashing" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Hashing
            </div>
          </div>
        </a>
      
      
        
        <a href="../../Memory/memory-state-machine/" class="md-footer__link md-footer__link--next" aria-label="Next: Memory" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Memory
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://t.me/polygonhermez" target="_blank" rel="noopener" title="t.me" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8Zm114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452 0 0 1 3.53 6.716 43.765 43.765 0 0 1 .417 9.769Z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://github.com/hermeznetwork/hermez-docs" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.tracking"], "search": "../../../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>